<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>D3 Demo</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
  </head>

  <body>
    <select name="pitchers"  onchange="getStats(this.value)">
      <option value="" selected disabled>Select a pitcher</option>
      <option value="519242">Chris Sale</option>
      <option value="519144">Rick Porcello</option>
      <option value="519141">Drew Pomeranz</option>
      <option value="456034">David Price</option>
      <option value="453214">Steven Wright</option>
    </select>
      
    <script>
      function getStats(player) {
        var baseURL = "http://gd2.mlb.com/components/game/mlb/year_2017/pitchers/"
        var playerURL = player + ".xml"
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            pitcher = getPitcher(this);
            var graphic = d3.select("body").select("svg");
            if (graphic.empty()) {
              display(pitcher);
            } else {
              update(pitcher);
            }
          }
        };
        xhttp.open("GET", baseURL + playerURL, true);
        xhttp.send();
      }

      function getPitcher(xml) {
        var xmlDoc = xml.responseXML;
        var x = xmlDoc.getElementsByTagName("pitching")[0].attributes;
        var p = [];
        var nameKey = {w: "W", l: "L", era: "ERA", s_ip: "IP", s_h: "H", s_er: "ER", s_r: "R", s_bb: "BB", s_k: "K", s_sv: "SV", s_hbp: "HBP"};
      
        for (var i = 12; i < 23; i++) {
          p.push(nameKey[x[i].nodeName]);
          p.push(x[i].nodeValue);
        }                  
        return p;                 
      }

      function display(data) {
        var w = 1200;
        var h = 50;
        var padding = 1;
        var svg = d3.select("body")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);
                            
                     
        svg.selectAll("rect")
        .data(data)
        .enter()
        .append("rect")
        .attr("x", function(d, i) {
            if (i % 2 == 0) {
              return i * w/data.length;
            } else {
              return (i-1) * w/data.length;
            }
          }
        )
        .attr("y", function(d, i) {
            return (i % 2 == 0) ? 0 : h/2;
          }
        )
        .attr("width", (2 * w / data.length) - padding)
        .attr("height", h/2 - padding)
        .attr("fill", "darkgray");

        svg.selectAll("text")
        .data(data)
        .enter()
        .append("text")
        .text(function(d) {
            return d;
          }
        )
        .attr("x", function(d, i) {
            if (i % 2 == 0) {
              return i * w/data.length + w/data.length;
            } else {
              return (i-1) * w/data.length + w/data.length;
            }
          }
        )
        .attr("y", function(d, i) {
            return (i % 2 == 0) ? h/2-6 : h-6;
          }
        )
        .attr("font-family", "sans-serif")
        .attr("font-size", "20px")
        .attr("fill", "white")
        .attr("text-anchor", "middle");         
      }

      function update(data) {
        d3.select("body").select("svg").selectAll("text")
          .data(data)
          .text(function(d) {
            return d;
          }
        )
      }
                             
    </script>
  </body>
</html>
